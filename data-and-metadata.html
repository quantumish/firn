<html><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,500;1,400&amp;display=swap" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/prism.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/firn_base.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/basscss.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/css/customization.css" rel="stylesheet" /><link href="https://firn.theiceshelf.com/static/img/favico.png" rel="icon" type="image/png" /><title>Firn - The Ice Shelf</title><script src="https://firn.theiceshelf.com/static/js/prism.js"></script></head><body><nav class="nav"><div class="nav-container"><div class="nav-left"><div id="nav-icon" onClick="toggleMenu()"><span></span><span></span><span></span><span></span></div><img class="nav-logo" src="https://firn.theiceshelf.com/static/img/ico-light.png" width="32" /></div><div class="nav-links"><a class="nav-links-item" href="https://firn.theiceshelf.com/"><span>Home</span></a><a class="nav-links-item" href="https://firn.theiceshelf.com/getting-started"><span>Docs</span></a><a class="nav-links-item" href="https://github.com/theiceshelf/firn"><span>Github</span></a></div></div></nav><main class="def-wrapper"><aside class="def-sidebar unfocused" id="sidebar"><ul class="firn-sitemap firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/index">Home</a></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/getting-started">Getting Started</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/tutorial">Step by Step Tutorial</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/setup">Firn Setup (with Emacs)</a></li></ul></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/content">Content</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/front-matter">Front Matter</a></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/layout">Layouts and Partials</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/layout_examples">Layout/Partial Examples</a></li></ul></li><li class="firn-sitemap-item--child"><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/the-render-function">The Render Function</a><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/files-and-headlines">Files And Headlines</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/folding">Folding</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/sitemap">Sitemap</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/adjacent-files">Adjacent Files</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/backlinks_and_related_files">Backlinks and Related Files</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/org_tags">Org Tags</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/firn_tags">Firn Tags</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/table-of-contents">Table Of Contents</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/logbooks">Logbooks</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/breadcrumbs">Breadcrumbs</a></li></ul></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/pages">Custom Pages</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/styling">Styling and third-party Javascript</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/data-and-metadata">Data and Metadata</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/static-assets">Static Assets / Attachments</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/rss">Rss</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/custom-todos">Custom Todos</a></li></ul></li><li class="firn-sitemap-item--child"><div class="firn-sitemap-item--no-link">Reference</div><ul class="firn-sitemap-item--parent"><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/configuration">Configuration</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/limitations">Limitations</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/sample-page">Sample Page</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/changelog">Changelog</a></li><li><a class="firn-sitemap-item--link" href="https://firn.theiceshelf.com/repl">Repl</a></li></ul></li></ul></aside><article class="def-content-wrap"><div class="def-content"><h1 class="mb0">Data and Metadata</h1><div class="flex h6 mb1"><div class="pr1">Last updated: </div><div class="italic">2021-05-23 13:58</div></div><div><section><p><span>ðŸš§ This document is in flux as Firn's API shifts and changes. ðŸš§</span></p><p><span>This document describes the data and metadata made available in Firn when it
comes time to customize the rendering of your content in your </span><a class="firn-internal" href="https://firn.theiceshelf.com/layout">layouts</a><span>. This is a
more advanced topic that may require a bit of comfort with Clojure.</span></p><p><span>Because Firn transforms org files into a data structure, it is possible to group
content available to users who want more advanced control and flexibility with
their data. The two main sections in the document provide the following:</span></p><p><strong><span>Metadata</span></strong><span> - a description of the opinionated choices Firn makes to organize data
for end-users.</span></p><p><strong><span>Data</span></strong><span> - the raw data available when a file is parsed - and how to access it if
you need more fine-grained control of your data.</span></p><hr /></section><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="metadata"><span class="firn-headline-text"><span>Metadata</span></span></h1><section><p><span>The following table describes all the data and functions "passed" to a layout each time a layout is applied to the data representing an org file. If the </span><a class="firn-internal" href="https://firn.theiceshelf.com/the-render-function">render function</a><span> already does everything you need in your layouts, then this section may not be valuable for you.</span></p><table><tr><td><span>Function/Data</span></td><td><span>Intent</span></td><td><span>Data-type</span></td></tr><tr></tr><tr><td><span>build-url</span></td><td><span>Function to more easily construct internal URLs</span></td><td><span>function</span></td></tr><tr><td><span>config</span></td><td><span>The site-wide config, containing everything!</span></td><td><span>map</span></td></tr><tr><td><span>date-created</span></td><td><span>The </span><code>#+DATE_CREATED</code><span> value of the processed file</span></td><td><span>string</span></td></tr><tr><td><span>date-updated</span></td><td><span>The </span><code>#+DATE_UPDATED</code><span> value of the processed file</span></td><td><span>string</span></td></tr><tr><td><span>file</span></td><td><span>The file as a data structure</span></td><td><span>map</span></td></tr><tr><td><span>file-links</span></td><td><span>A list of links per file</span></td><td><span>list</span></td></tr><tr><td><span>firn-tags</span></td><td><span>A map of tag names mapped to files.</span></td><td><span>map</span></td></tr><tr><td><span>firn-under</span></td><td><span>The </span><code>#+FIRN_UNDER</code><span> value of the file</span></td><td><span>string</span></td></tr><tr><td><span>logbook</span></td><td><span>A list of logbook entries of the processed-file.</span></td><td><span>list</span></td></tr><tr><td><span>logbook-total</span></td><td><span>The sum of all the logbook entries per file</span></td><td><span>string</span></td></tr><tr><td><span>meta</span></td><td><span>A map of metadata per file (logbook, links, keywords)</span></td><td><span>map</span></td></tr><tr><td><span>org-tags</span></td><td><span>A map of or org tags and associated headlines.</span></td><td><span>map</span></td></tr><tr><td><span>partials</span></td><td><span>a list of invokable partials from the </span><code>/partials</code><span> dir</span></td><td><span>list</span></td></tr><tr><td><span>render</span></td><td><span>See the </span><a class="firn-internal" href="https://firn.theiceshelf.com/the-render-function">Render Function document</a></td><td><span>function</span></td></tr><tr><td><span>site-author</span></td><td><span>The site author used for SEO.</span></td><td><span>string</span></td></tr><tr><td><span>site-desc</span></td><td><span>The site description used for RSS and SEO.</span></td><td><span>string</span></td></tr><tr><td><span>site-links</span></td><td><span>A list of all links across all documents</span></td><td><span>vector</span></td></tr><tr><td><span>site-logs</span></td><td><span>A list of all logbook entries</span></td><td><span>vector</span></td></tr><tr><td><span>site-todos</span></td><td><span>A list of all todos on a Firn site</span></td><td><span>vector</span></td></tr><tr><td><span>site-map</span></td><td><span>A map of all files sorted by </span><code>#+FIRN_UNDER</code></td><td><span>map</span></td></tr><tr><td><span>site-title</span></td><td><span>The site title used for RSS and SEO.</span></td><td><span>string</span></td></tr><tr><td><span>site-url</span></td><td><span>The site URL used to build link in templates.</span></td><td><span>string</span></td></tr><tr><td><span>title</span></td><td><span>The </span><code>#+TITLE</code><span> value of the file.</span></td><td><span>string</span></td></tr></table><p><span>This may seem like a lot of information to make available to a layout template.
And that's because it is! But thanks to destructuring in Clojure, you can make
your templates only ask for what they need:</span></p><pre class="language-clojure"><code class="language-clojure">(defn project
  [{:keys [ render partials logbook] :as data}] ; < destructuring to make available only what you need.
  (let [{:keys [head nav main-section]} partials]
    (head)
    [:body
     (nav)
     [:main.main-container
      (page-header data)
      [:div.container
       (main-section render)
       (my-custom-logbook-chart logbook) ; passing logbook to a custom function, perhaps defined prior to the "project" function.
       ]]]))
</code></pre><p><span>The above template only needs access to </span><code>render</code><span>, </span><code>partials</code><span> and the </span><code>logbook</code><span>. Then
functions, such as </span><code>page-header</code><span> (which must be defined above the </span><code>project</code><span>
function) can simply take the data map and destructure what </span><em><span>it</span></em><span> needs again:</span></p><pre class="language-clojure"><code class="language-clojure">(defn page-header
  [{:keys [title logbook-total date-updated date-created firn-under]}]
  (let [rndr (fn [i s]
               (when i [:span.flex.pr2
                        [:h4.italic.bold.pr1 s " "]
                        [:h4.italic.thin i]]))]
    [:div.page_meta
     [:h1.page_meta_title title]
     [:div.flex
      (rndr date-created "Published: ")
      (rndr date-updated "Last Updated: ")
      (rndr firn-under "File Under: ")
      (when-not (= logbook-total "0:00")
        (rndr logbook-total "Time Logged: "))]]))

</code></pre><p><span>As per the table above, there is quite a bit of data that is made available to
your layouts. If you want to know more about the shape of your data (such as</span><a class="firn-internal" href="https://firn.theiceshelf.com/logbooks">logbooks</a><span>, </span><a class="firn-internal" href="https://firn.theiceshelf.com/org_tags">org-tags</a><span>, and so on), visit these pages to learn more.</span></p></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="parsed-org-file-data"><span class="firn-headline-text"><span>Parsed Org File Data</span></span></h1><section><p><span>Org files are parsed using a parser library called </span><a class="firn-external" href="https://github.com/PoiScript/orgize" target="_blank">Orgize</a><span>. When processing or
serving your site, Firn sends your org-file as a string into Orgize, and gets
back a data structure representing the contents of your file.</span></p><p><span>Currently, the raw parsed output of Orgize is stored in the </span><code>file</code><span> map under</span><code>:as-edn</code><span>. As per using your layouts as described in the Metadata section above,
you can access the file map in your layouts.</span></p><p><span>A simple file with a few headings, tasks, logbook, etc, looks like this
after being parsed to JSON and converted to EDN:</span></p><p><span><details>
<summary> Click to view code sample</summary></span></p><pre class="language-clojure"><code class="language-clojure">{:type "document",
 :children
 [{:type "section",
   :children
   [{:type "keyword",
     :key "TITLE",
     :value "Sample File!"}
    {:type "keyword",
     :key "FIRN_LAYOUT",
     :value "default"}]}
  {:type "headline",
   :level 1,
   :children
   [{:type "title",
     :level 1,
     :raw "Meta",
     :properties
     {:file_under "Projects",
      :state "active",
      :date_completed "?",
      :links "?",
      :intent "Wiki",
      :date_started "<2020-03-01 Sun>",
      :slug "firn"},
     :children [{:type "text", :value "Meta"}]}
    {:type "section",
     :children
     [{:type "drawer",
       :name "LOGBOOK",
       :children
       [{:type "clock",
         :start {:year 2020, :month 3, :day 28, :dayname "Sat", :hour 15, :minute 45},
         :end {:year 2020, :month 3, :day 28, :dayname "Sat", :hour 18, :minute 29},
         :duration "2:44"}]}]}]}
  {:type "headline",
   :level 1,
   :children
   [{:type "title",
     :level 1,
     :raw "Headlines <2020-03-27 Fri>",
     :properties {:foo "bar"},
     :children
     [{:type "text", :value "Headlines "}
      {:type "timestamp",
       :timestamp_type "active",
       :start
       {:year 2020,
        :month 3,
        :day 27,
        :dayname "Fri"}}]}
    {:type "section",
     :children
     [{:type "paragraph",
       :children
       [{:type "text",
         :value "and some stuff with a date: "}
        {:type "timestamp",
         :timestamp_type "active",
         :start
         {:year 2020,
          :month 3,
          :day 27,
          :dayname "Fri"}}
        {:type "text", :value "\r"}]}]}
    {:type "headline",
     :level 2,
     :children
     [{:type "title",
       :level 2,
       :keyword "TODO",
       :raw "Headline (2) with /keyword/",
       :children
       [{:type "text",
         :value "Headline (2) with "}
        {:type "italic",
         :children
         [{:type "text",
           :value "keyword"}]}]}]}
    {:type "headline",
     :level 2,
     :children
     [{:type "title",
       :level 2,
       :priority "B",
       :keyword "TODO",
       :raw "Headline 2 with priority",
       :children
       [{:type "text",
         :value "Headline 2 with priority"}]}]}]}
  {:type "headline",
   :level 1,
   :children
   [{:type "title",
     :level 1,
     :raw "Some Links",
     :children
     [{:type "text", :value "Some Links"}]}
    {:type "section",
     :children
     [{:type "paragraph",
       :children
       [{:type "text", :value "A "}
        {:type "verbatim", :value "file:"}
        {:type "text", :value " link "}
        {:type "link",
         :path "file:file2.org",
         :desc "File 2"}
        {:type "text", :value "\r"}]}]}]}
  {:type "headline",
   :level 1,
   :children
   [{:type "title",
     :level 1,
     :raw "Tables",
     :children
     [{:type "text", :value "Tables"}]}
    {:type "section",
     :children
     [{:type "paragraph",
       :children
       [{:type "text",
         :value
         "Some tables with texte markup in them\r"}]}
      {:type "table",
       :table_type "org",
       :tblfm nil,
       :children
       [{:type "table-row", :table_row_type "standard",
         :children
         [{:type "table-cell", :children [{:type "text", :value "1"}]}
          {:type "table-cell", :children [{:type "text", :value "2"}]}
          {:type "table-cell", :children [{:type "text", :value "3"}]}
          {:type "table-cell", :children [{:type "text", :value "4"}]}
          {:type "table-cell", :children [{:type "text", :value "5"}]}]}
        {:type "table-row",
         :table_row_type "rule"}
        {:type "table-row",
         :table_row_type "standard",
         :children
         [{:type "table-cell",
           :children
           [{:type "text", :value "foo"}]}
          {:type "table-cell",
           :children
           [{:type "verbatim", :value "foo"}]}
          {:type "table-cell",
           :children
           [{:type "italic",
             :children
             [{:type "text",
               :value "italic"}]}]}
          {:type "table-cell"}
          {:type "table-cell",
           :children
           [{:type "bold",
             :children
             [{:type "text",
               :value "bold"}]}]}]}]}]}]}]}
</code></pre><p><span></details></span></p></section><div class="firn-headline-section firn-headline-section-2"><h2 class="firn-headline firn-headline-2" id="interacting-with-data"><span class="firn-headline-text"><span>Interacting with data</span></span><span class="firn-org-tags"><span><a class="firn-org-tag" href="/tags#limitation">limitation</a></span></span></h2><section><p><span>As you can see, lots of data. Currently, Firn is not capable of interacting with
this data very easily while you develop your Layouts. There are tentative plans
to include a REPL, or at least the ability to </span><code>println debug</code><span> in future releases.
For now, it is possible to independently use the </span><a class="firn-external" href="https://orgize.herokuapp.com" target="_blank">Orgize parser online</a><span> to see
test results as JSON.</span></p></section></div></div></div><div class="adjacent-files"><span><div class="firn-file-navigation"><span class="firn-file-nav-prev">Previous: <a href="https://firn.theiceshelf.com/styling">Styling and third-party Javascript</a></span> <span class="firn-file-nav-next">Next: <a href="https://firn.theiceshelf.com/static-assets">Static Assets / Attachments</a></span></div></span></div><footer><script src="/static/js/main.js"></script></footer></div></article><aside class="def-toc unfocused" id="toc"><div><h4>Contents</h4><div><ol><li><a href="#metadata">Metadata</a></li><li><a href="#parsed-org-file-data">Parsed Org File Data</a><ol><li><a href="#interacting-with-data">Interacting with data</a></li></ol></li></ol></div></div><div><h4>Backlinks</h4><ul class="firn-backlinks"><li class="firn-backlink"><a href="https://firn.theiceshelf.com/content">Content</a></li></ul></div></aside></main></body></html>